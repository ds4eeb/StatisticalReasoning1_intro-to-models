---
title: "Activity 9: Statistical reasoning 1: intro to models"
subtitle: Feb. 4th, 2026, Calvin Munson
format: gfm
execute:
  warning: false
editor: source
---

------------------------------------------------------------------------

You will submit two outputs for this activity:

1.  A **PDF** of a rendered Quarto document with all of your R code. Please create a new Quarto document (e.g. don't use this `README.qmd`), include all of the code that appears in this document, in addition to adding your own code and **answers to all of the questions** in the "Q#" sections. Submit this through Gradescope.

2.  A plot and your answers from the final section. Submit that content to the google slide below: <https://docs.google.com/presentation/d/1AJVu0eq5-OoRGi4UlBervrqKbFHOINvAB-8u0JaFzYM/edit?usp=sharing>

*If you have trouble submitting as a PDF, please ask Calvin or Malin for help. If we still can't solve it, you can submit the .qmd file instead.*

A reminder: **Please label the code** in your final submission in two ways: 1) denote your answers to each question using headers that correspond to the question you're answering and 2) thoroughly "comment" your code: remember, this means annotating your code directly by typing descriptions of what each line does after a `#`. This will help future you!

------------------------------------------------------------------------

Let's start by reading in the relevant packages

```{r}
library(brms) # for statistics
library(tidyverse)
library(ggeffects) # for the prediction plot
library(lterdatasampler)

```



------------------------------------------------------------------------

# 1. Fiddler crabs

Fiddler crab picture here

The data today is fiddler crab size data from 13 salt marshes from Florida to Massachusetts. Crab size was measured as carapace width. Air and water temperature data from nearby monitoring programs are also included.

```{r}
head(pie_crab)
```

------------------------------------------------------------------------

## 1.1 Plot data, pick the model

The first step is to graph our data so we can have a visual sense of what's going on. Let's say that our ultimate goal is to understand whether the size of crabs changes with latitude in a test of Bergmann's rule:

> “One of the best-known patterns in biogeography is Bergmann’s rule. It predicts that organisms at higher latitudes are larger than ones at lower latitudes. Many organisms follow Bergmann’s rule, including insects, birds, snakes, marine invertebrates, and terrestrial and marine mammals. What drives Bergmann’s rule? Bergmann originally hypothesized that the organisms he studied, birds, were larger in the colder, higher latitudes due to heat-conservation. But the heat-conservation hypothesis relies on internal regulation of body temperature and therefore does not apply to ectotherms, some of which also follow Bergmann’s rule. There is likely no universal mechanism underpinning Bergmann’s rule, regardless of ecto- or endothermy. As a result, other mechanisms have been proposed to explain Bergmann’s rule, including the starvation-resistant hypothesis, the diet-quality hypothesis, the enemy hypothesis, the resource rule, seasonality hypothesis, and the temperature–size rule (Johnson et al., 2019).”

To start, let's plot carapace width (`size`) on the y axis with `latitude` on the x axis.

```{r}
pie_crab %>% 
  ggplot(aes(x = latitude, y = size)) +
  geom_point() +
  # Make the y-axis include 0
  ylim(0, NA)
```

------------------------------------------------------------------------

### Q1.1 Interpret the graph

Interpret this graph: Does it look like size increases with latitude? Describe how confident you are in this interpretation.

------------------------------------------------------------------------

### Q1.2 Beautify this graph

Make this graph look a bit nicer!

```{r}

```

---------

Now that you've spent some time pondering the data, let's put together our first model. From lecture, linear models follow the equation:

$y = intercept + slope*x$

Let's set up our model to look like:

$size = intercept + slope*latitude$



------------------------------------------------------------------------

## 1.2 Fit linear regression with `brms`

------------------------------------------------------------------------

Time to run the model! There's a lot here: let's dig in line-by-line.

```{r}
# latitude
m.crab.lat <- 
  brm(data = pie_crab, # Give the model the pie_crab data
      # Choose a gaussian (normal) distribution
      family = gaussian,
      # Specify the model here. 
      size ~ latitude,
      # Here's where you specifiy different parameters for executing the Markov chains
      iter = 2000, warmup = 1000, chains = 4, cores = 4,
      # Setting the "seed" sets a given set of random numbers. 
      # In this case, it makes the randomness of the Markov chain runs reproducible 
      # (so that both of us get the exact same results when running the model)
      seed = 4,
      # Save the fitted model object as output - helpful for reloading in the output later
      file = "output/m.crab.lat")
```

### Q1.3 What does the "iter" argument do?

Navigate to the `brm` help page to answer: What does the `iter = ` argument do?

------


## 1.3 Interpret model

Let's look at our summary table of our model's output.

```{r}
summary(m.crab.lat)
```

The output reminds us of our model formula that we chose (`size ~ latitude`). Most important to answering our question are the parameter `estimates`. Remember, our model was $size = intercept + slope*latitude$. The `slope` parameter is going to tell us what the effect of latitude is: for instance, for every one unit of latitude, what is the effect on size. We need to translate that to the units that those variables represent: the slope value is thus *for every one degree of latitude, carapace size changes this much in millimeters*. 

Looking at our table, we see the estimate for `latitude` is 0.48: This indicates that the model estimated that for every 1 degree latitude, carapace width increases by 0.48mm.

Earlier you were asked to "*describe how confident you are in this interpretation*" when qualitatively interpreting the graph of `size` vs `latitude`. How credible is it that the model output's slope of 0.48 is actually different from zero? In other words, if the data was truly just randomly plopped on that graph, with no relationship between x and y, the model would probably not pick up a slope of exactly zero; it would likely be small, but not zero. So is 0.48 reasonably different from zero? 

To assess this, we look at the lower and upper 95% Credible Interval columns (`l-95% CI` and `u-95% CI` respectively) and see if that interval range intersects with zero. We can see that our slope estimate (the estimate of `latitude`) ranges from 0.42 to 0.55 - zero is not included in this range, so we can reasonably conclude here that the true effect of latitude on body size is somewhere between those values, and importantly, NOT zero!

------------------------------------------------------------------------

## 1.4 Assess model

Now we need to assess whether or not our model actually ran correctly. 

```{r}
summary(m.crab.lat)
```

We do this by looking at the `Rhat` (R hat) column, which should be very close to 1. If you remember from lecture, this model runs multiple chains that converge on estimates for the slope and the intercept. An R hat of 1 tells us that those four chains converged on the same estimate. This looks fine for us!

# NEED HELP ASSESSING SIGMA

We also need to look at the sigma value. Need help assessing this!!!

```{r}
plot(m.crab.lat) # show posteriors and chains
```

```{r}
m.crab.lat$fit
```


------------------------------------------------------------------------

## 1.5 Plot model on the data



------------------------------------------------------------------------

## 1.6 Repeat with a new variable: water temp sd

Let's repeat this example with a new variable: the water temperature standard deviation. The standard deviation (sd) can be used as a metric of variability: higher sd means higher variability. We can ask: *is higher variability in water temperature associated with fiddler crab body size?*

```{r}
pie_crab %>% 
  ggplot(aes(x = water_temp_sd, y = size)) +
  geom_point() +
  # Make the y-axis include 0
  ylim(0, NA)
```

### Q1.X Interpret the graph

Does it look like size increases with latitude? Describe how confident you are in this interpretation.

-------------

We'll set up our model to look like:

$size = intercept + slope*water_temp_sd$

--------

### Q1.XX Set up and run this new model

```{r}

# water temp sd
m.crab.watersd <- 
  brm(data = pie_crab, 
      family = gaussian,
      size ~ water_temp_sd,
      iter = 2000, warmup = 1000, chains = 4, cores = 4,
      seed = 4,
      file = "output/m.crab.watersd")

plot(m.crab.watersd) # show posteriors and chains
summary(m.crab.watersd)
m.crab.watersd$fit

```


----------

# 2.

### Q2.10 Export graphs

Export both graphs and both interpretations to this slide deck: <https://docs.google.com/presentation/d/1AJVu0eq5-OoRGi4UlBervrqKbFHOINvAB-8u0JaFzYM/edit?usp=sharing>

### Render to PDF

And submit the well-labeled PDF on Gradescope. Thanks!

```{r}


lterdatasampler::nwt_pikas

nwt_pikas %>% 
  ggplot(aes(x = date, y = concentration_pg_g)) +
  geom_point()
```

m.p.1 \<- brm(data = nwt_pikas, family = gaussian, concentration_pg_g \~ date, iter = 2000, warmup = 1000, chains = 4, cores = 4, seed = 4, file = "output/m.p.1")

plot(m.p.1) \# show posteriors and chains summary(m.p.1) m.p.1\$fit

# Elevation model

m.p.elev \<- brm(data = nwt_pikas, family = gaussian, concentration_pg_g \~ elev_m, iter = 2000, warmup = 1000, chains = 4, cores = 4, seed = 4, file = "output/m.p.elev")

plot(m.p.elev) \# show posteriors and chains summary(m.p.elev) m.p.elev\$fit \`\`\`
